/**
 * angular-schema-form-nwp-file-upload - Upload file type for Angular Schema Form
 * @version v0.1.5
 * @link https://github.com/saburab/angular-schema-form-nwp-file-upload
 * @license MIT
 */
"use strict";angular.module("schemaForm").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,i,a){var r="Wrong file type. Allowed types are ",l="This file is too large. Maximum size allowed is ",n="Current file size:",s="You have to upload at least one file",t="You can't upload more than one file.",o=function(i,o,m){if("array"===o.type&&"singlefile"===o.format){o.pattern&&o.pattern.mimeType&&!o.pattern.validationMessage&&(o.pattern.validationMessage=r),o.maxSize&&o.maxSize.maximum&&!o.maxSize.validationMessage&&(o.maxSize.validationMessage=l,o.maxSize.validationMessage2=n),o.minItems&&o.minItems.minimum&&!o.minItems.validationMessage&&(o.minItems.validationMessage=s),o.maxItems&&o.maxItems.maximum&&!o.maxItems.validationMessage&&(o.maxItems.validationMessage=t);var d=e.stdFormObj(i,o,m);return d.key=m.path,d.type="nwpFileUpload",m.lookup[a.stringify(m.path)]=d,d}};e.defaults.array.unshift(o);var m=function(i,o,m){if("array"===o.type&&"multifile"===o.format){o.pattern&&o.pattern.mimeType&&!o.pattern.validationMessage&&(o.pattern.validationMessage=r),o.maxSize&&o.maxSize.maximum&&!o.maxSize.validationMessage&&(o.maxSize.validationMessage=l,o.maxSize.validationMessage2=n),o.minItems&&o.minItems.minimum&&!o.minItems.validationMessage&&(o.minItems.validationMessage=s),o.maxItems&&o.maxItems.maximum&&!o.maxItems.validationMessage&&(o.maxItems.validationMessage=t);var d=e.stdFormObj(i,o,m);return d.key=m.path,d.type="nwpFileUpload",m.lookup[a.stringify(m.path)]=d,d}};e.defaults.array.unshift(m),i.addMapping("bootstrapDecorator","nwpFileUpload","directives/decorators/bootstrap/nwp-file/nwp-file.html")}]),angular.module("ngSchemaFormFile",["ngFileUpload","ngMessages"]).directive("ngSchemaFile",["Upload","$timeout","$q",function(e,i,a){return{restrict:"A",scope:!0,require:"ngModel",link:function(a,r,l,n){function s(r){if(r&&!r.$error&&a.url){var l={url:a.url,file:{}};l.file[a.form.fileName||"file"]=r,r.upload=e.upload(l),r.upload.then(function(e){i(function(){r.result=e.data});var l=a.form.post?a.form.post(e.data):e.data;n.$setViewValue(l),n.$commitViewValue()},function(e){e.status>0&&(a.errorMsg=e.status+": "+e.data)}),r.upload.progress(function(e){r.progress=Math.min(100,parseInt(100*e.loaded/e.total))})}}a.url=a.form&&a.form.endpoint,a.isSinglefileUpload=a.form&&a.form.schema&&"singlefile"===a.form.schema.format,a.selectFile=function(e){a.picFile=e},a.selectFiles=function(e){a.picFiles=e},a.uploadFile=function(e){e&&s(e)},a.uploadFiles=function(e){e.length&&angular.forEach(e,function(e){s(e)})},a.validateField=function(){a.uploadForm.file&&a.uploadForm.file.$valid&&a.picFile&&!a.picFile.$error?console.log("singlefile-form is invalid"):a.uploadForm.files&&a.uploadForm.files.$valid&&a.picFiles&&!a.picFiles.$error?console.log("multifile-form is  invalid"):console.log("single- and multifile-form are valid")},a.submit=function(){a.uploadForm.file&&a.uploadForm.file.$valid&&a.picFile&&!a.picFile.$error?a.uploadFile(a.picFile):a.uploadForm.files&&a.uploadForm.files.$valid&&a.picFiles&&!a.picFiles.$error&&a.uploadFiles(a.picFiles)},a.$on("schemaFormValidate",a.validateField),a.$on("schemaFormFileUploadSubmit",a.submit)}}}]),angular.module("schemaForm").run(["$templateCache",function(e){e.put("directives/decorators/bootstrap/nwp-file/nwp-file.html",'<ng-form class="file-upload mb-lg" ng-schema-file ng-model="$$value$$" name="uploadForm">\n    <label ng-show="form.title && form.notitle !== true" class="control-label" for="fileInputButton" ng-class="{\'sr-only\': !showTitle(), \'text-danger\': uploadForm.$error.required && !uploadForm.$pristine}">\n        {{ form.title }}<i ng-show="form.required">&nbsp;*</i>\n    </label>\n    <div ng-show="picFile">\n        <div ng-include="\'uploadProcess.html\'" class="mb"></div>\n    </div>\n    <ul ng-show="picFiles && picFiles.length" class="list-group">\n        <li class="list-group-item" ng-repeat="picFile in picFiles">\n            <div ng-include="\'uploadProcess.html\'"></div>\n        </li>\n    </ul>\n    <div class="well well-sm bg-white mb" ng-class="{\'has-error border-danger\': (uploadForm.$error.required && !uploadForm.$pristine) || (hasError() && errorMessage(schemaError()))}">\n        <small class="text-muted" ng-show="form.description" ng-bind-html="form.description"></small>\n        <div ng-if="isSinglefileUpload" ng-include="\'singleFileUpload.html\'"></div>\n        <div ng-if="!isSinglefileUpload" ng-include="\'multiFileUpload.html\'"></div>\n        <div class="help-block mb0" ng-show="uploadForm.$error.required && !uploadForm.$pristine">{{ \'modules.attribute.fields.required.caption\' | translate }}</div>\n        <div class="help-block mb0" ng-show="(hasError() && errorMessage(schemaError()))" ng-bind-html="(hasError() && errorMessage(schemaError()))"></div>\n    </div>\n</ng-form>\n<script type=\'text/ng-template\' id="uploadProcess.html">\n    <div class="row mb">\n        <div class="col-sm-4 mb-sm">\n            <label title="{{ form.i18n.preview? form.i18n.preview : (\'modules.upload.field.preview\' | translate)}}" class="text-info">{{ form.i18n.preview? form.i18n.preview : (\'modules.upload.field.preview\' | translate)}}</label>\n            <img ngf-src="picFile" class="img-thumbnail img-responsive">\n            <div class="img-placeholder" ng-class="{\'show\': picFile.$invalid && !picFile.blobUrl, \'hide\': !picFile || picFile.blobUrl}">No preview available\n            </div>\n        </div>\n        <div class="col-sm-4 mb-sm">\n            <label title="{{ form.i18n.filename ? form.i18n.filename : (\'modules.upload.field.filename\' | translate)  }}" class="text-info">{{ form.i18n.filename ? form.i18n.filename : (\'modules.upload.field.filename\' | translate)}}</label>\n            <div class="filename" title="{{ picFile.name }}">{{ picFile.name }}</div>\n        </div>\n        <div class="col-sm-4 mb-sm">\n            <label title="{{ form.i18n.progress ? form.i18n.progress : (\'modules.upload.field.progress\' | translate)  }}" class="text-info">{{ form.i18n.progress ? form.i18n.progress : (\'modules.upload.field.progress\' | translate) }}</label>\n            <div class="progress">\n                <div class="progress-bar progress-bar-striped" role="progressbar" ng-class="{\'progress-bar-success\': picFile.progress == 100}" ng-style="{width: picFile.progress + \'%\'}">\n                    {{ picFile.progress }} %\n                </div>\n            </div>\n            <button class="btn btn-primary btn-sm" type="button" ng-click="uploadFile(picFile)" ng-disabled="!picFile || picFile.$error">{{ form.i18n.upload ? form.i18n.upload : (\'buttons.upload\' | translate) }}\n            </button>\n        </div>\n    </div>\n    <div ng-messages="uploadForm.$error" ng-messages-multiple="">\n        <div class="text-danger errorMsg" ng-message="maxSize">{{ form[picFile.$error].validationMessage | translate }} <strong>{{picFile.$errorParam}}</strong>. ({{ form[picFile.$error].validationMessage2 | translate }} <strong>{{picFile.size / 1000000|number:1}}MB</strong>)</div>\n        <div class="text-danger errorMsg" ng-message="pattern">{{ form[picFile.$error].validationMessage | translate }} <strong>{{picFile.$errorParam}}</strong></div>\n        <div class="text-danger errorMsg" ng-message="maxItems">{{ form[picFile.$error].validationMessage | translate }} <strong>{{picFile.$errorParam}}</strong></div>\n        <div class="text-danger errorMsg" ng-message="minItems">{{ form[picFile.$error].validationMessage | translate }} <strong>{{picFile.$errorParam}}</strong></div>\n        <div class="text-danger errorMsg" ng-show="errorMsg">{{errorMsg}}</div>\n    </div>\n</script>\n<script type=\'text/ng-template\' id="singleFileUpload.html">\n    <div ngf-drop="selectFile(picFile)" ngf-select="selectFile(picFile)" type="file" ngf-multiple="false" ng-model="picFile" name="file" ng-attr-ngf-pattern="{{form.schema.pattern && form.schema.pattern.mimeType ? form.schema.pattern.mimeType : undefined }}" ng-attr-ngf-max-size="{{form.schema.maxSize && form.schema.maxSize.maximum ? form.schema.maxSize.maximum : undefined }}" ng-required="form.required" accept="{{form.schema.pattern && form.schema.pattern.mimeType}}" ng-model-options="form.ngModelOptions" ngf-drag-over-class="dragover" class="drop-box dragAndDropDescription">\n        <p class="text-center">{{form.i18n.dragorclick ? form.i18n.dragorclick:(\'modules.upload.descriptionSinglefile\' | translate)}}</p>\n    </div>\n    <div ngf-no-file-drop>{{ \'modules.upload.dndNotSupported\' | translate}}</div>\n    <button ngf-select="selectFile(picFile)" type="file" ngf-multiple="false" ng-model="picFile" name="file" ng-attr-ngf-pattern="{{form.schema.pattern && form.schema.pattern.mimeType ? form.schema.pattern.mimeType : undefined }}" ng-attr-ngf-max-size="{{form.schema.maxSize && form.schema.maxSize.maximum ? form.schema.maxSize.maximum : undefined }}" ng-required="form.required" accept="{{form.schema.pattern && form.schema.pattern.mimeType}}" ng-model-options="form.ngModelOptions" id="fileInputButton" class="btn btn-primary btn-block {{form.htmlClass}} mt-lg mb">\n        <fa fw="fw" name="upload" class="mr-sm"></fa>\n        {{form.i18n.add ? form.i18n.add : (\'buttons.add\' | translate)}}\n    </button>\n</script>\n<script type=\'text/ng-template\' id="multiFileUpload.html">\n    <div ngf-drop="selectFiles(picFiles)" ngf-select="selectFiles(picFiles)" type="file" ngf-multiple="true" ng-model="picFiles" name="files" ng-attr-ngf-pattern="{{form.schema.pattern && form.schema.pattern.mimeType ? form.schema.pattern.mimeType : undefined }}" ng-attr-ngf-max-size="{{form.schema.maxSize && form.schema.maxSize.maximum ? form.schema.maxSize.maximum : undefined }}" ng-required="form.required" accept="{{form.schema.pattern && form.schema.pattern.mimeType}}" ng-model-options="form.ngModelOptions" ngf-drag-over-class="dragover" class="drop-box dragAndDropDescription">\n        <p class="text-center">{{form.i18n.dragorclick ? form.i18n.dragorclick:(\'modules.upload.descriptionMultifile\' | translate)}}</p>\n    </div>\n    <div ngf-no-file-drop>{{ \'modules.upload.dndNotSupported\' | translate}}</div>\n    <button ngf-select="selectFiles(picFiles)" type="file" ngf-multiple="true" multiple ng-model="picFiles" name="files" accept="{{form.schema.pattern && form.schema.pattern.mimeType}}" ng-attr-ngf-pattern="{{form.schema.pattern && form.schema.pattern.mimeType ? form.schema.pattern.mimeType : undefined }}" ng-attr-ngf-max-size="{{form.schema.maxSize && form.schema.maxSize.maximum ? form.schema.maxSize.maximum : undefined }}" ng-required="form.required" ng-model-options="form.ngModelOptions" id="fileInputButton" class="btn btn-primary btn-block {{form.htmlClass}} mt-lg mb">\n        <fa fw="fw" name="upload" class="mr-sm"></fa>\n        {{form.i18n.add ? form.i18n.add : (\'buttons.add\' | translate)}}\n    </button>\n</script>')}]);